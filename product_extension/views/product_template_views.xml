<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_product_template_insert_custom_group" model="ir.ui.view">
        <field name="name">product.template.insert.custom.group</field>
        <field name="model">product.template</field>
        <field name="priority" eval="105"/>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='general_information']/group[1]/group[@name='group_standard_price']"
                   position="before">
                <group name="custom_group">
                    <!-- your fields here -->
                    <string></string>
                </group>
            </xpath>

        </field>
    </record>

    <record id="view_product_template_form_code" model="ir.ui.view">
        <field name="name">product.template.form.code</field>
        <field name="model">product.template</field>
        <!-- Higher priority to ensure we modify fields added by other inherits -->
        <field name="priority" eval="99"/>
        <!-- Inherit from the view that injects default_code after categ_id -->
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">


            <!-- Hide default_code field in product form -->
            <xpath expr="//field[@name='default_code']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <!-- Hide categ_id from General Information page -->
            <xpath expr="//field[@name='categ_id']" position="replace"/>
            <xpath expr="//field[@name='type']" position="replace"/>

            <!-- Add categ_id after name field in the header -->
            <xpath expr="//div[@class='oe_title']" position="after">
                <group>
                    <field name="categ_id" string="Category" class="mb-2" required="1"/>
                    <field name="internal_reference_new" string="Reference"
                           class="ms-2"
                           style="width: 200px; font-size: 14px;"
                           readonly="categ_id.reference_type == 'automatic'"
                           placeholder="Reference"
                           help="Internal reference for the product. Automatically generated when category is set to 'Automatic'."/>

                    <field name="type" class="ms-2 mb-2"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Move is_storable and tracking fields to Inventory page -->
    <record id="view_product_template_move_tracking_to_inventory" model="ir.ui.view">
        <field name="name">product.template.move.tracking.to.inventory</field>
        <field name="model">product.template</field>
        <field name="priority" eval="100"/>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <!-- Hide is_storable and tracking from General Information page (where stock module adds them) -->
            <xpath expr="//field[@name='type']/following-sibling::label[@for='is_storable']" position="replace"/>
            <xpath expr="//field[@name='type']/following-sibling::div[field[@name='is_storable']]" position="replace"/>

            <!-- Add is_storable and tracking to Inventory page -->
            <xpath expr="//page[@name='inventory']//group[@name='inventory']" position="inside">
                <group name="tracking_group" string="Inventory Tracking" invisible="type != 'consu'">
                    <label for="is_storable" class="oe_inline"/>
                    <div class="o_row w-100">
                        <field name="is_storable"/>
                        <field name="tracking" invisible="not is_storable" groups="stock.group_production_lot"/>
                    </div>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Add subscription_ok field next to purchase_ok (if purchase_ok is visible) or after sale_ok -->
    <record id="view_product_template_subscription_ok" model="ir.ui.view">
        <field name="name">product.template.subscription.ok</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <!-- Add subscription_ok field after sale_ok in the options div -->
            <xpath expr="//div[@name='options']//span[@class='d-inline-flex']" position="inside">
                <field name="subscription_ok"/>
                <label for="subscription_ok"/>
            </xpath>

        </field>
    </record>

    <!-- Move invoice_policy and product_tooltip fields from General Information page to Sales page -->
    <record id="view_product_template_move_invoice_policy" model="ir.ui.view">
        <field name="name">product.template.move.invoice.policy</field>
        <field name="model">product.template</field>
        <field name="priority" eval="102"/>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <!-- Hide invoice_policy from General Information page (where sale module adds it after type) -->
            <xpath expr="//field[@name='invoice_policy']" position="replace"/>

            <!-- Hide product_tooltip from General Information page -->
            <xpath expr="//field[@name='product_tooltip']" position="replace"/>
            <!-- Add invoice_policy and product_tooltip to Sales page -->
            <xpath expr="//page[@name='sales']//group[@name='sale']" position="before">
                <group name="invoice_policy_group" string="Invoicing">
                    <field name="invoice_policy" required="1" invisible="not sale_ok or type == 'combo'"/>
                    <field name="product_tooltip"
                           class="fst-italic text-muted"
                           string=""
                           invisible="not product_tooltip"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Add Variants page after Attributes & Variants page -->
    <record id="view_product_template_variants_page" model="ir.ui.view">
        <field name="name">product.template.variants.page</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <!-- Locate the Attributes & Variants page by the field it contains -->
            <xpath expr="//page[@name='sales']" position="before">
                <page name="product_variants_list" string="Varints">
                    <field name="product_variant_ids" nolabel="1">
                        <list string="Product Variants">
                            <field name="default_code" string="Internal Reference"/>
                            <field name="barcode"/>
                            <!--                            <field name="active"/>-->
                            <field name="standard_price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="lst_price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="product_template_attribute_value_ids" widget="many2many_tags" readonly="1"/>
                        </list>
                        <form>
                            <sheet>
                                <group>
                                    <group>
                                        <field name="default_code" string="Internal Reference"/>
                                        <field name="barcode"/>
                                        <field name="active"/>
                                    </group>
                                    <group>
                                        <field name="standard_price" widget="monetary"
                                               options="{'currency_field': 'currency_id'}"/>
                                        <field name="lst_price" widget="monetary"
                                               options="{'currency_field': 'currency_id'}"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="product_template_attribute_value_ids" widget="many2many_tags"
                                           readonly="1"/>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_product_template_reference" model="ir.ui.view">
        <field name="name">product.template.reference</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <!-- internal_reference_new is now placed after name field in view_product_template_form_code -->
            <!-- This view only handles standard_price readonly attribute -->
            <xpath expr="//field[@name='standard_price']" position="attributes">
                <attribute name="readonly">cost_method != 'standard'</attribute>
            </xpath>
        </field>
    </record>

    <!-- Change the string name of the variants page to "Attributes" -->
    <record id="view_product_template_variants_page_name" model="ir.ui.view">
        <field name="name">product.template.variants.page.name</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='variants']" position="replace">
                <attribute name="string">Attributes</attribute>
            </xpath>
            <xpath expr="//page[@name='general_information']" position="replace">
                <page string="General Information" name="general_info">
                    <group>
                        <group>
                            <field name="type" invisible="1"/>
                            <label for="list_price"/>
                            <div name="list_price_uom">
                                <field name="list_price"
                                       class="oe_inline"
                                       widget="monetary"
                                       options="{'currency_field': 'currency_id', 'field_digits': True}"/>
                                <span
                                        name="uom_span"
                                        groups="uom.group_uom"
                                        invisible="type == 'combo'"
                                >
                                    per
                                    <field
                                            name="uom_id"
                                            class="oe_inline" style="max-width:136px"
                                            options="{'no_create': True}"
                                    />
                                </span>
                            </div>
<!--                            <field name="purchase_price"/>-->
                            <label
                                    for="standard_price"
                                    invisible="(id and product_variant_count != 1
                                                            and not is_product_variant) or type == 'combo'"
                                    id="standard_price_label"
                            />
                            <div
                                    name="standard_price_uom"
                                    invisible="(id and product_variant_count != 1
                                                            and not is_product_variant) or type == 'combo'"
                            >
                                <field
                                        name="standard_price"
                                        class="oe_inline"
                                        widget="monetary"
                                        options="{
                                        'currency_field': 'cost_currency_id',
                                        'field_digits': True,}"
                                />
                            </div>
                            <field name="barcode"/>
                        </group>
                        <group>
                            <field name="taxes_id" widget="many2many_tags"/>
                            <field name="supplier_taxes_id" widget="many2many_tags"/>
                        </group>

                    </group>
                </page>
            </xpath>
        </field>
    </record>


</odoo>

