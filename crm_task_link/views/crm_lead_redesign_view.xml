<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="action_view_expenses_by_lead" model="ir.actions.act_window">
        <field name="name">Lead Expenses</field>
        <field name="res_model">hr.expense</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('lead_id', '=', active_id)]</field>
        <field name="context">{}</field>
    </record>
    <record id="view_crm_lead_form_custom" model="ir.ui.view">
        <field name="name">crm.lead.form.custom</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">

            <!-- Make the form RTL -->
            <xpath expr="//sheet" position="attributes">
                <attribute name="style">direction: rtl;</attribute>
            </xpath>


            <!-- Add "๐ ูุฑุตุฉ:" before name -->
            <xpath expr="//div[hasclass('oe_title')]" position="replace">
                <div class="oe_title" style="margin-bottom: 16px;">
                    <div style="display: ruby; align-items: center; font-size: 26px; font-weight: bold;direction: rtl; justify-content: flex-end;">
                        <span>๐ูุฑุตุฉ :</span>
                        <field name="name"
                               class="ms-2 text-break"
                               options="{'line_breaks': False}"
                               widget="text"
                               style="margin-right: 8px;"/>
                    </div>
                </div>
            </xpath>


            <xpath expr="//div[hasclass('oe_title')]" position="after">
                
                <!-- Hidden fields for computed statistics -->
                <div style="display: none;">
                    <field name="opportunity_age_days"/>
                    <field name="days_until_deadline"/>
                    <field name="is_deadline_overdue"/>
                    <field name="has_files"/>
                    <field name="files_status_message"/>
                    <field name="files_status_color"/>
                    <field name="opportunity_status_color"/>
                    <field name="has_opportunity_warning"/>
                    <field name="warning_count"/>
                    <field name="warning_messages"/>
                </div>
                
                <!-- ุฅุญุตุงุฆูุงุช ุงููุฑุตุฉ -->
                <div class="opportunity_statistics_container" style="background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                    <div class="opportunity_statistics_grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        
                        <!-- ุนูุฑ ุงููุฑุตุฉ -->
                        <div style="background: #fff; border-radius: 6px; padding: 12px; text-align: center; border-left: 3px solid #667eea;">
                            <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">๐ ุนูุฑ ุงููุฑุตุฉ</div>
                            <div style="font-size: 22px; color: #2c3e50; font-weight: 600;">
                                <field name="opportunity_age_days" readonly="1"/>
                            </div>
                            <div style="font-size: 10px; color: #6c757d;">ููู</div>
                        </div>
                        
                        <!-- ุงูุฃูุงู ุงููุชุจููุฉ -->
                        <div style="background: #fff; border-radius: 6px; padding: 12px; text-align: center; border-left: 3px solid #11998e;">
                            <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">โฑ๏ธ ุงูุฃูุงู ุงููุชุจููุฉ</div>
                            <div style="font-size: 22px; font-weight: 600;">
                                <field name="days_until_deadline" readonly="1"
                                       decoration-danger="is_deadline_overdue == True"
                                       decoration-warning="days_until_deadline &lt; 7 and days_until_deadline &gt; 0"
                                       decoration-success="days_until_deadline &gt;= 7"/>
                            </div>
                            <div style="font-size: 10px; color: #6c757d;">ููู</div>
                        </div>
                        
                        <!-- ุญุงูุฉ ุงููููุงุช -->
                        <div style="background: #fff; border-radius: 6px; padding: 12px; text-align: center; border-left: 3px solid #38ef7d;">
                            <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">๐ ุงููููุงุช</div>
                            <div style="font-size: 14px; font-weight: 600; margin: 5px 0;">
                                <field name="files_status_message" readonly="1"
                                       decoration-success="has_files == True"
                                       decoration-warning="has_files == False"/>
                            </div>
                        </div>
                        
                        <!-- ุญุงูุฉ ุงููุฑุตุฉ -->
                        <div style="background: #fff; border-radius: 6px; padding: 12px; text-align: center; border-left: 3px solid #667eea;">
                            <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">๐ ุงูุญุงูุฉ</div>
                            <div style="font-size: 14px; font-weight: 600; margin: 5px 0;">
                                <field name="stage_id" readonly="1"
                                       decoration-success="opportunity_status_color == 'success'"
                                       decoration-danger="opportunity_status_color == 'danger'"
                                       decoration-info="opportunity_status_color == 'info'"/>
                            </div>
                        </div>
                        
                        <!-- ุงูุชุญุฐูุฑุงุช -->
                        <div style="background: #fff; border-radius: 6px; padding: 12px; text-align: center; border-left: 3px solid #ff6b6b;">
                            <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">โ๏ธ ุงูุชุญุฐูุฑุงุช</div>
                            <div style="font-size: 22px; font-weight: 600;">
                                <field name="warning_count" readonly="1"
                                       decoration-danger="warning_count &gt; 0"
                                       decoration-success="warning_count == 0"/>
                            </div>
                            <div style="font-size: 10px; color: #6c757d;">ุชูุจูู</div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- ูุนูููุงุช ุงููุฑุตุฉ -->
                <div style="margin-bottom: 30px;">
                    <div style="font-size: 18px; font-weight: 700; color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #667eea;">
                        ๐ ูุนูููุงุช ุงููุฑุตุฉ
                    </div>
                    
                    <div class="opportunity_info_grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        
                        <!-- ุงููุณุคูู -->
                        <div class="field_user" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #667eea; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐ค ุงููุณุคูู</div>
                            <field name="user_id" style="font-size: 15px; font-weight: 500; color: #2c3e50;"/>
                        </div>
                        
                        <!-- ุงูุนููู -->
                        <div class="field_partner" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #764ba2; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐ข ุงูุนููู</div>
                            <field name="partner_id" style="font-size: 15px; font-weight: 500; color: #2c3e50;"/>
                    </div>
                        
                        <!-- ุงููุดุฑูุน ุงููุฑุชุจุท -->
                        <div class="field_project" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #11998e; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐๏ธ ุงููุดุฑูุน ุงููุฑุชุจุท</div>
                            <field name="project_id" style="font-size: 15px; font-weight: 500; color: #2c3e50;"/>
                        </div>
                        
                        <!-- ุชุงุฑูุฎ ุงูุงูุชูุงุก -->
                        <div class="field_deadline" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #f45c43; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐ ุชุงุฑูุฎ ุงูุงูุชูุงุก</div>
                            <field name="date_deadline" style="font-size: 15px; font-weight: 500; color: #2c3e50;"/>
                    </div>

                        <!-- ูุณุจุฉ ุงูุฅุบูุงู -->
                        <div class="field_probability" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #38ef7d; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐ ูุณุจุฉ ุงูุฅุบูุงู</div>
                            <div style="font-size: 15px; font-weight: 500; color: #2c3e50;">
                                <field name="probability" widget="float" readonly="1"/>%
                            </div>
                        </div>
                        
                        <!-- ุงูุฅูุฑุงุฏุงุช ุงููุชููุนุฉ -->
                        <div class="field_revenue" style="background: #f8f9fa; border-radius: 10px; padding: 18px; border-left: 4px solid #eb3349; transition: all 0.3s;">
                            <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">๐ฐ ุงูุฅูุฑุงุฏุงุช ุงููุชููุนุฉ</div>
                            <field name="expected_revenue" widget="monetary"
                                   options="{'currency_field': 'company_currency'}"
                                   style="font-size: 15px; font-weight: 500; color: #2c3e50;"/>
                        </div>
                        
                    </div>

                    
                </div>
                
                <!-- ูุงุฆูุฉ ุงูุชุญุฐูุฑุงุช ูุงูุชูุจููุงุช -->
                <div class="alert" role="alert" style="margin-top: 20px;" 
                     invisible="warning_count == 0">
                    <h5 style="margin-bottom: 15px; font-weight: 700;">
                        โ๏ธ ุชูุจููุงุช ูุชุญุฐูุฑุงุช (<field name="warning_count" readonly="1" nolabel="1"/>)
                    </h5>
                    <div style="white-space: pre-line; font-size: 14px; line-height: 1.8;">
                        <field name="warning_messages" readonly="1" nolabel="1"/>
                    </div>
                </div>

            </xpath>

            <xpath expr="//group[.//field[@name='partner_id']]" position="replace">
                <!-- ุนูุตุฑ ูุงุฑุบ ููุญู ูุญู ุงูู group ุจุงููุงูู -->
            </xpath>
            <xpath expr="//page[@name='internal_notes']" position="attributes">
                <attribute name="string">ููุงุญุธุงุช ุฏุงุฎููุฉ</attribute>
            </xpath>

            <xpath expr="//page[@name='lead']" position="replace">
                <page string="ุชูุงุตูู ุงูุนููู">
                    <group>
                        <field name="partner_id" string="Customer"/>
                        <field name="tag_ids" widget="many2many_tags"
                               options="{'color_field': 'color', 'no_create_edit': True}"/>
                        <field name="email_from" string="Email" widget="email"/>
                        <field name="website" widget="url" string="Website"/>
                        <field name="phone" widget="phone" string="Phone"/>
                        <field name="mobile" widget="phone" string="Mobile"/>

                    </group>
                </page>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="ุงูุชูููุฉ ุงููุชููุนุฉ">
                    <div class="oe_title" style="margin-top: 20px; font-weight: bold;">๐ ุนุฑูุถ ุงูุฃุณุนุงุฑ ุงููุฑุชุจุทุฉ</div>

                    <group>
                        <field name="quotation_ids">
                            <list>
                                <field name="name"/>
                                <field name="partner_id"/>
                                <field name="amount_untaxed"/>
                                <field name="amount_tax"/>
                                <field name="amount_total"/>
                                <field name="state"/>
                            </list>
                        </field>
                        <field name="total_quotation_untaxed" widget="monetary"
                               options="{'currency_field': 'company_currency'}" string="ุฅุฌูุงูู ุจุฏูู ุถุฑูุจุฉ"/>
                        <field name="total_quotation_tax" widget="monetary"
                               options="{'currency_field': 'company_currency'}" string="ูููุฉ ุงูุถุฑูุจุฉ"/>
                        <field name="total_quotation_total" widget="monetary"
                               options="{'currency_field': 'company_currency'}" string="ุงูุฅุฌูุงูู ุงูููู"/>
                        <field name="total_expense_amount" readonly="1" widget="monetary"
                               options="{'currency_field': 'company_currency'}" string="ุฅุฌูุงูู ุงููุตุงุฑูู "/>

                        <field name="total_revenue_amount" widget="monetary"
                               options="{'currency_field': 'company_currency'}" string="ุฅุฌูุงูู ุงูุฑุจุญ"/>



                        <field name="revenue_margin_percent"
                               widget="badge"
                               options="{'color_field': 'revenue_margin_color', 'text_align': 'center'}"/>

                        <!--                        <div class="col-md-6">-->
                        <!--                            <div style="background: #e3f2fd; padding: 1rem; border-radius: 0.75rem; text-align: center;">-->
                        <!--                                <field name="expected_revenue" widget="monetary"-->
                        <!--                                       options="{'currency_field': 'company_currency','color_field': 'revenue_margin_color'}"/>-->
                        <!--                                <div style="font-size: 13px; color: #666;">ุงูุฅูุฑุงุฏุงุช ุงููุชููุนุฉ</div>-->
                        <!--                            </div>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-md-6">-->
                        <!--                            <div style="background: #e3f2fd; padding: 1rem; border-radius: 0.75rem; text-align: center;">-->
                        <!--                                <field name="expected_revenue" widget="monetary"-->
                        <!--                                       options="{'currency_field': 'company_currency'}"/>-->
                        <!--                                <div style="font-size: 13px; color: #666;">ุงูุฅูุฑุงุฏุงุช ุงููุชููุนุฉ</div>-->
                        <!--                            </div>-->
                        <!--                        </div>-->


                    </group>
                    <!--                    <group>-->
                    <!--                        <field name="operational_expense_ids" string="ุงููุตุฑููุงุช">-->
                    <!--                            <list editable="bottom" options="{'footer': 'total'}">-->
                    <!--                                <field name="category_id" string="ุงููุฆุฉ"/>-->
                    <!--                                <field name="description" string="ุงููุตู"/>-->
                    <!--                                <field name="date" string="ุงูุชุงุฑูุฎ"/>-->
                    <!--                                <field name="amount" string="ุงููุจูุบ"/>-->

                    <!--                            </list>-->
                    <!--                        </field>-->

                    <!--                    </group>-->
                    <!--                    <div style="text-align: end; font-weight: bold;">-->
                    <!--                        ุงูุฅุฌูุงูู:-->
                    <!--                        <field name="operational_expense_total"/>-->
                    <!--                    </div>-->


                </page>
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">


                <button type="action"
                        name="%(action_view_expenses_by_lead)d"
                        class="oe_stat_button"
                        icon="fa-money"
                        modifiers="{'invisible': [['vendor_bill_count', '=', 0]]}">
                    <div class="o_stat_info">
                        <div class="o_stat_text">ุงููุตุฑููุงุช</div>
                        <span class="o_stat_text">
                            <field name="total_expense_amount" widget="monetary"
                                   options="{'currency_field': 'company_currency'}"/>
                        </span>

                    </div>
                </button>

            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="ุงููุตุงุฑูู ุงูุชุดุบูููุฉ" style="direction: ltr;">
                    <group>
                        <field name="expense_ids" 
                               context="{'show_sum': True, 'default_lead_id': id, 'default_project_id': project_id, 'default_analytic_distribution': default_expense_analytic_distribution, 'active_model': 'crm.lead', 'active_id': id}">
                            <list editable="bottom">
                                <field name="name" string="ุงููุตู"/>
                                <field name="product_id" string="ุงููุฆุฉ" domain="[('can_be_expensed', '=', True)]"/>
                                <field name="total_amount" string="ุงููุจูุบ" sum="Total"/>
                                <field name="currency_id"/>
                                <field name="date" string="ุชุงุฑูุฎ ุงูุตุฑู"/>
                                <field name="analytic_distribution" string="ุงููุดุฑูุน" widget="analytic_distribution" 
                                       options="{'product_field': 'product_id', 'account_field': 'account_id', 'business_domain': 'expense'}"/>
                                <field name="state" string="ุงูุญุงูุฉ"/>
                            </list>
                        </field>
                    </group>
                    <group>
                        <field name="total_expense_amount" readonly="1" widget="monetary"
                               options="{'currency_field': 'company_currency'}"/>
                    </group>


                </page>
            </xpath>

        </field>
    </record>


</odoo>
